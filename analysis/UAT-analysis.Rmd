---
title: "CRUK FGC analysis pipeline UAT"
author: "Alex Kalinka"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output:
  html_document:
    code_folding: hide
    depth: 3
    highlight: tango
    number_sections: true
    theme: spacelab
    toc: true
    toc_float: true
params:
  output_v1: FALSE
  output_v2: FALSE
---

# Setup

```{r setup, include=FALSE}
set.seed(1)

options(warn=-1)
suppressMessages(library(knitr))
suppressMessages(library(tidyr))
suppressMessages(library(magrittr))
suppressMessages(library(ggplot2))
suppressMessages(library(dplyr))

if(!params$output_v1 || !params$output_v2)
  stop("Both 'output_v1' and 'output_v2' paths must be provided in the list given to the 'params' argument")

## Common functions.
# Unpack the v1 data tarballs/zip archives to the current working directory.
unpack_inputs <- function(){
  ret <- NULL
  v1_files <- list.files(params$output_v1, full.names = T)
  for(file in v1_files){
    if(grepl("zip$",file)){
      system(paste("unzip",file))
    }
    if(grepl("tar.gz$",file)){
      fname <- gsub("^(.*?).tar.gz$","\\1",file)
      system(paste("gunzip",file))
      system(paste("tar -xf",paste(fname,".tar",sep="")))
    }
  }
}

# Compare output file structure.
compare_analysis_files <- function(path_v1, path_v2){
  cwd <- getwd()
  setwd(path_v1)
  v1_files <- list.files(path_v1, full.names = T, recursive = T)
  setwd(path_v2)
  v2_files <- list.files(path_v2, full.names = T, recursive = T)
  return(all.equal(v1_files, v2_files))
}

# Compare counts.
compare_counts <- function(path_v1, path_v2){
  
}

# Compare Mageck gene summary output.
compare_mageck <- function(path_v1, path_v2){
  
}

tryCatch(unpack_inputs(),
         error = function(e) stop(paste("error unpacking v1 outputs:",e))
)

```

# Concordance of pipeline outputs with v1

## 1. Multi-SLX data (Venetoclax sub-sampled FASTQs)

```{r}

```

## 2. HT29 (SLX-17741)



## 3. Public data (Venetoclax)

### From FASTQs


### From combined counts



# Performance evaluation

## 1. Binomial-Thinned dataset



